/**
 * RiojaWall v1
 *
 * Copyright 2016, Gerard Rodes https://github.com/GerardRodes
 *
 * Released under the MIT license - http://opensource.org/licenses/MIT
 */
!function(a){const b={itemSelector:".item",cols:4,animation:!1,transition:"1s ease-in-out",marginX:0,marginY:0,shareItems:!0,responsive:!0,justImages:!0,breakpoints:[{maxWidth:480,cols:1},{maxWidth:860,cols:2},{maxWidth:1200,cols:3}]};a.fn.extend({riojaWall:function(d){var e=a.extend({},b,d);if(this.length>1){var f=[];return this.each(function(){f.push(c(this,e))}),f}return c(this,e)}});var c=function(a,b){var c=new d(a,b);return c.init(),c},d=function(b,c){var d=this;d.container=a(b),d.items=d.container.find(c.itemSelector),d.cols=[],d.allImages=d.container.find("img"),d.loadedImages=0,d.initCols=c.cols,d.resizeTimeout,d.init=function(){d.container.css("position","relative"),d.updateWidth(),d.loadCols(),d.updateHeight(),d.items.length>2*d.cols.length&&d.equalizeItems(),d.bindImages()},d.destroy=function(){a.each(d.cols,function(a,b){b.items.each(function(a,b){b.element.css({position:"static",width:"",left:"",top:""})})})},d.loadCols=function(){d.cols=[];for(var a=0;a<c.cols;a++){var b=d.items.filter(function(b,d,e){return(b-a)%c.cols==0});d.cols.push(new e(d,a,b,d.container.width()/c.cols,c))}},d.updateWidth=function(){if(c.responsive){var a=c.breakpoints.filter(function(a,b,c){return a.maxWidth>=window.innerWidth})[0];void 0!=a?c.cols=a.cols:c.cols=d.initCols}},d.updateHeight=function(){var a=d.getHighestCol();void 0!=a&&d.container.css("minHeight",a.height)},d.getHighestCol=function(){return d.cols.concat().sort(function(a,b){return a.height<b.height})[0]},d.getShortestCol=function(){return d.cols.concat().sort(function(a,b){return a.height>b.height})[0]},d.equalizeItems=function(){var b=d.cols.concat().sort(function(a,b){return a.height<b.height});a.each(b,function(a,b){for(var c=b.getLastItem();b.height-c.element.height()>d.getShortestCol().height;)d.getShortestCol().appendItem(b.popItem())})},d.bindImages=function(){a.each(d.cols,function(b,e){e.items.each(function(b,f){var g=f.element.find("img");a(g).load(function(){d.updateHeight(),e.arrangeItems()}).each(function(){this.complete&&a(this).load()}),a("<img/>").attr("src",a(g).attr("src")).load(function(){f.imgWidth=this.width,f.imgHeight=this.height,d.loadedImages++,e.arrangeItems(),d.loadedImages==d.allImages.length&&(d.updateHeight(),d.items.length>2*d.cols.length&&c.shareItems&&d.equalizeItems()),e.arrangeItems()})})})},c.animation&&d.items.css("transition",c.transition)},e=function(b,c,d,e,g){var h=this;h.index=c,h.items=d.map(function(a,b){return new f(b,a)}),h.width=e-g.marginX/2,h.marginX=g.marginX,h.marginY=g.marginY,h.height=0,h.init=function(){h.arrangeItems()},h.popItem=function(){var a=h.items.slice(-1)[0];return h.items=h.items.slice(0,h.items.length-1),h.arrangeItems(),a},h.appendItem=function(a){h.items.push(a),h.arrangeItems()},h.getLastItem=function(){return h.items.slice(-1)[0]},h.updateHeight=function(){h.height=parseInt(b.container.css("paddingTop"))+h.marginY*h.items.length,g.justImages?h.items.map(function(a,b){h.height+=b.imgHeight}):h.items.map(function(a,b){h.height+=b.element.height()}),b.updateHeight()},h.arrangeItems=function(){a.each(h.items,function(a,c){var d=h.items.slice(0,a),e=a*h.marginY+parseInt(b.container.css("paddingTop"));d.each(function(a,b){e+=g.justImages?h.width*b.imgHeight/b.imgWidth:b.element.height()}),c.element.css({position:"absolute",width:h.width,left:h.width*h.index+h.marginX*h.index,top:e})}),h.updateHeight()},h.init()},f=function(b,c){var d=this;d.element=a(b),d.depth=c,d.imgHeight=a(b).height(),d.imgWidth=a(b).width()}}(jQuery);
